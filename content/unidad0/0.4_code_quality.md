# 0.4 Calidad de Código y Estándares Industriales

## 1. "Code runs computers, but is read by humans"

Un código que funciona pero es ilegible es **código basura**.
En la industria, el 80% del tiempo se gasta leyendo y manteniendo código existente, no escribiendo nuevo. Por eso, existen estándares estrictos sobre cómo debe verse el código.

Si entregas un código con variables llamadas `x`, `temp`, o sin espacios consistentes, serás rechazado en cualquier entrevista técnica seria.

---

## 2. PEP 8: La Constitución de Python

Python tiene una guía oficial de estilo: **PEP 8 (Python Enhancement Proposal #8)**.
Dicta las reglas estéticas del lenguaje.

### Reglas Cardinales del PEP 8:
1.  **Indentación:** 4 espacios. Ni 2, ni 8, y **JAMÁS** tabuladores. (Configura VS Code para convertir Tabs a Espacios).
2.  **Longitud de línea:** Máximo 79 u 88 caracteres.
    *   *¿Por qué?* Para poder tener 2 o 3 archivos abiertos lado a lado en un monitor.
3.  **Espacios en blanco:**
    *   Bien: `x = y + 1`
    *   Mal: `x=y+1` (Parece un solo bloque ilegible).
4.  **Nombres:**
    *   `snake_case`: variables, funciones, módulos (`mi_variable`, `calcular_impuesto`).
    *   `PascalCase` (o CapWords): Clases (`UsuarioController`, `MainWindow`).
    *   `UPPER_CASE`: Constantes (`PI`, `MAX_CONNECTIONS`).

---

## 3. Herramientas Automáticas (The Toolchain)

Nadie memoriza el PEP 8 completo. Usamos robots para aplicarlo.

### 3.1 Formatters (Maquillaje)
Reescriben tu código para que se vea bonito. No cambian la lógica.
La herramienta estándar hoy es **Black**.

**Filosofía de Black:** "The Uncompromising Code Formatter".
Black no te pregunta cómo quieres el código. Black decide por ti. Esto elimina discusiones en los equipos sobre estilos.

```bash
pip install black
black .
```
*Antes:*
```python
x= {  'a':37,'b':42,

'c':927}
```
*Después de Black:*
```python
x = {"a": 37, "b": 42, "c": 927}
```

### 3.2 Linters (Detectives)
Analizan tu código en busca de errores lógicos, variables no usadas, o violaciones de estilo que un formatter no puede arreglar.

La herramienta recomendada es **Flake8** (combina PyFlakes, pycodestyle y McCabe).

```bash
pip install flake8
flake8 .
```
*Salida típica:*
`src/main.py:15:1: F401 'sys' imported but unused`

### 3.3 Type Checkers (Compiladores Estáticos)
Como vimos en 0.3, Python 3.10+ soporta tipos. **Mypy** es la herramienta que valida que no estés mintiendo.

```bash
pip install mypy
mypy src/
```
Si dices `def suma(a: int)`, y llamas `suma("hola")`, Mypy lanzará error. Esto previene miles de bugs en runtime.

---

## 4. Docstrings y Documentación

Python usa **Docstrings** (triple comilla `"""`) para documentar funciones y clases.

### Formato Google Style (Recomendado)
Es más limpio que el formato Sphinx/reStructuredText clásico.

```python
def calcular_interes(monto: float, tasa: float) -> float:
    """Calcula el interés compuesto anual.

    Args:
        monto (float): La cantidad inicial de dinero.
        tasa (float): La tasa de interés anual en decimal (ej. 0.05).

    Returns:
        float: El monto final tras un año.

    Raises:
        ValueError: Si el monto es negativo.
    """
    if monto < 0:
        raise ValueError("Monto negativo")
    return monto * (1 + tasa)
```

**Beneficio:**
Al poner el mouse sobre la función en VS Code, verás esta documentación formateada elegantemente.

---

## 5. Complejidad Ciclomática (McCabe)

Es una métrica matemática que dice "qué tan difícil es testear este código".
Cuenta cuántos caminos independientes (if/else/for/while) tiene una función.

*   1-5: Simple.
*   5-10: Complejo.
*   10+: **Refactorizar inmediatamente.**

Flake8 puede advertirte de esto:
`flake8 --max-complexity=10 .`

Si tienes una función con 15 `if` anidados, divídela en 3 funciones más pequeñas.

---

## 6. Principios SOLID en Python

La calidad no es solo estética; es arquitectura.

1.  **S (Single Responsibility):** Una función/clase debe hacer UNA sola cosa.
    *   Mal: `class Usuario` que guarda en BD, envía emails y valida passwords.
    *   Bien: `UsuarioModel`, `EmailService`, `AuthValidator`.
2.  **O (Open/Closed):** Abierto a extensión, cerrado a modificación. Usa herencia o inyección de dependencias en lugar de modificar el código original.
3.  **L (Liskov Substitution):** Una subclase debe poder reemplazar a su padre sin romper nada.
4.  **I (Interface Segregation):** Mejor muchas interfaces pequeñas que una gigante. (En Python usamos Protocolos/ABCs).
5.  **D (Dependency Inversion):** Depende de abstracciones, no de concreciones.

---

## 7. Testing Automático

El código de calidad **siempre** tiene pruebas.

### `unittest` vs `pytest`
*   `unittest`: Viene en la stdlib. Es estilo Java (clases, `assertEqual`). Verboso.
*   `pytest`: Estándar industrial. Usa `assert` nativo. Muy conciso.

**Ejemplo Pytest:**
```python
# test_calculadora.py
from calculadora import sumar

def test_sumar_positivos():
    assert sumar(2, 2) == 4

def test_sumar_negativos():
    assert sumar(-1, -1) == -2
```

Ejecutar: `pytest`.
Pytest encontrará mágicamente todos los archivos `test_*.py` y ejecutará las funciones.

---

## 8. Git Hooks (Pre-commit)

Somos humanos. Se nos olvidará correr `black` antes de hacer commit.
**pre-commit** es una herramienta que corre scripts *automáticamente* cuando haces `git commit`. Si el linter falla, el commit se cancela.

### Configuración `.pre-commit-config.yaml`
```yaml
repos:
-   repo: https://github.com/psf/black
    rev: 24.2.0
    hooks:
    -   id: black
-   repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
    -   id: flake8
```

Instalación:
`pip install pre-commit`
`pre-commit install`

Ahora tu repositorio es a prueba de código sucio.

---

## 9. Checklist de Calidad para Entregas

En esta materia, tu código será evaluado bajo estos criterios:

1.  ¿Pasa el linter (`flake8`) sin errores?
2.  ¿Está formateado con `black`?
3.  ¿Tiene Type Hints en las funciones públicas?
4.  ¿Las variables tienen nombres descriptivos en Inglés o Español (consistente)?
5.  ¿No hay funciones de más de 30 líneas? (Excepciones razonables permitidas).
6.  ¿El archivo tiene el Docstring de módulo explicando qué hace?

**"Code is poetry."** Escríbelo con orgullo.

<div align="center">

[⬅️ Anterior: 0.3 Repaso](0.3_python_review.md) &nbsp;&nbsp;|&nbsp;&nbsp; [Menú Unidad](README.md) &nbsp;&nbsp;|&nbsp;&nbsp; [Siguiente: 0.5 Estructura](0.5_project_structure.md) ➡️

</div>
